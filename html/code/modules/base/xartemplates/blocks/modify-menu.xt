<?xml version="1.0" encoding="utf-8"?>
<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">
    <!-- License: GPL http://www.gnu.org/copyleft/gpl.html -->
    <!--
        We know that blocks.css file is already included by admin-modify_instance.xd, so no need to do it twice
    -->
    <div class="xar-form-input-wrapper">
        <label for="marker" title="#xarML('When Xaraya is generating the menu, we can mark the current page. Use this to configure the marker for that display.')#" class="xar-form-label">
        Marker:
        </label>
        <input type="text" name="marker" id="marker" value="#xarVarPrepForDisplay($marker)#" maxlength="255" class="xar-form-textshort"/>
    </div>
    <div class="xar-form-input-wrapper">
        <label for="showback" title="#xarML('Select if you would like Xaraya to generate a link to the back end for administrative users at the bottom of the menu.')#" class="xar-form-label">
            Display Admin Link to Back End
        </label>
        <xar:data-input type="checkbox" name="showback" id="showback" checked="$showback"/>
    </div>
    <div class="xar-form-input-wrapper">
        <label for="showlogout" title="#xarML('Select if you would like Xaraya to generate a logout link for non-administrative users at the bottom of the menu.')#" class="xar-form-label">
            Display Logout
        </label>
        <xar:data-input type="checkbox" name="showlogout" checked="$showlogout" />
    </div>
    <div class="xar-form-input-wrapper">
        <label for="displayprint" title="#xarML('Select if you would like Xaraya to generate a link to your print page at the bottom of the menu.')#" class="xar-form-label">
            Display Print Link
        </label>
        <xar:data-input type="checkbox" name="displayprint" checked="$displayprint" />
    </div>
    <div class="xar-form-input-wrapper">
        <label for="displayrss" title="#xarML('Select if you would like Xaraya to generate a link to your RSS at the bottom of the menu.')#" class="xar-form-label">
            Display RSS Link
        </label>
        <xar:data-input type="checkbox" name="displayrss" checked="$displayrss" />
    </div>

    <xar:if condition="!empty($userlinks)">
        <xar:set name="visibleicon">#xarTplGetImage('icons/enabled.png', 'base')#</xar:set>
        <xar:set name="invisibleicon">#xarTplGetImage('icons/disabled.png', 'base')#</xar:set>
        <xar:var name="visibletitle">Link is visible in the menu</xar:var>
        <xar:var name="invisibletitle">Link is not visible in the menu</xar:var>
        <xar:set name="imgup">#xarTplGetImage('icons/go-up.png', 'base')#</xar:set>
        <xar:set name="imgdown">#xarTplGetImage('icons/go-down.png', 'base')#</xar:set>
        <xar:var name="imgupalt">Up</xar:var>
        <xar:var name="imgdownalt">Down</xar:var>
        <xar:var name="imguptitle">Move this link up</xar:var>
        <xar:var name="imgdowntitle">Move this link down</xar:var>
        <table id="menulinks_#$blockid#" class="xar-fullwidth xar-margin-nonebottom">
            <caption class="xar-align-left xar-margin-thickbottom xar-margin-nonetop">
                <strong>Menu Links</strong>
            </caption>
            <thead>
                <tr>
                    <th>&#160;</th>
                    <th>Label</th>
                    <th>Title</th>
                    <th>URL</th>
                    <th class="xar-align-center">State</th>
                    <th class="xar-align-right">Select</th>
                </tr>
            </thead>
            <tbody>
                <xar:foreach in="$userlinks" key="$linkid" value="$link">
                    <xar:set name="link_id">'userlinks_' . $linkid</xar:set>
                    <xar:set name="link_name">'userlinks[' . $linkid . ']'</xar:set>
                    <tr>
                        <td>|---</td>
                        <td>
                            <xar:set name="label_id">$link_id . '_label'</xar:set>
                            <xar:set name="label_name">$link_name . '[label]'</xar:set>
                            <xar:data-input type="textbox" class="xar-form-textmedium" name="$label_name" id="$label_id" maxlength="255" value="$link['label']"/>
                        </td>
                        <td>
                            <xar:set name="title_id">$link_id . '_title'</xar:set>
                            <xar:set name="title_name">$link_name . '[title]'</xar:set>
                            <xar:data-input type="textbox" class="xar-form-textlong" name="$title_name" id="$title_id" maxlength="255" value="$link['title']"/>
                        </td>
                        <td>
                            <xar:set name="url_id">$link_id . '_url'</xar:set>
                            <xar:set name="url_name">$link_name . '[url]'</xar:set>
                            <xar:data-input type="textbox" class="xar-form-textlong" name="$url_name" id="$url_id" maxlength="255" value="$link['url']"/>
                        </td>
                        <td class="xar-align-center">
                            <xar:if condition="!empty($link['visible'])">
                                <img src="#$visibleicon#" alt="visible" title="#$visibletitle#" class="xar-icon"/>
                            <xar:else/>
                                <img src="#$invisibleicon#" alt="hidden" title="#$invisibletitle#" class="xar-icon-disabled"/>
                            </xar:if>
                        </td>
                        <td class="xar-align-right">
                            <xar:if condition="!empty($link['upurl'])">
                                <a href="#$link['upurl']#" title="#$imguptitle#" class="xar-icon">
                                <img src="#$imgup#" alt="#$imgupalt#" class="xar-icon"/>
                                </a>
                            <xar:else/>
                                <img src="#$imgup#" alt="#$imgupalt#" class="xar-icon-disabled"/>
                            </xar:if>
                            <xar:if condition="!empty($link['downurl'])">
                                <a href="#$link['downurl']#" title="#$imgdowntitle#" class="xar-icon">
                                <img src="#$imgdown#" alt="#$imgdownalt#" class="xar-icon"/>
                                </a>
                            <xar:else/>
                                <img src="#$imgdown#" alt="#$imgdownalt#" class="xar-icon-disabled"/>
                            </xar:if>
                            <xar:set name="select_id">$link_id . '_select'</xar:set>
                            <xar:set name="select_name">$link_name . '[select]'</xar:set>
                            <xar:data-input type="checkbox" id="$select_id" name="$select_name"/>
                        </td>
                    </tr>
                    <xar:if condition="!empty($link['menulinks'])">
                        <xar:foreach in="$link['menulinks']" key="$sublinkid" value="$sublink">
                        <tr>
                            <xar:set name="sub_id">$link_id .'_menulinks_' . $sublinkid</xar:set>
                            <xar:set name="sub_name">$link_name . '[menulinks][' . $sublinkid . ']'</xar:set>
                            <td>
                                &#160;&#160;|-
                            </td>
                            <td>
                                <xar:set name="label_id">$sub_id . '_label'</xar:set>
                                <xar:set name="label_name">$sub_name . '[label]'</xar:set>
                                <xar:data-input type="textbox" class="xar-form-textmedium" name="$label_name" id="$label_id" maxlength="255" value="$sublink['label']"/>
                            </td>
                            <td>
                                <xar:set name="title_id">$sub_id . '_title'</xar:set>
                                <xar:set name="title_name">$sub_name . '[title]'</xar:set>
                                <xar:data-input type="textbox" class="xar-form-textlong" name="$title_name" id="$title_id" maxlength="255" value="$sublink['title']"/>
                            </td>
                            <td>
                                <xar:set name="url_id">$sub_id . '_url'</xar:set>
                                <xar:set name="url_name">$sub_name . '[url]'</xar:set>
                                <xar:data-input type="textbox" class="xar-form-textlong" name="$url_name" id="$url_id" maxlength="255" value="$sublink['url']"/>
                            </td>
                            <td class="xar-align-center">
                                <xar:if condition="!empty($sublink['visible'])">
                                    <xar:set name="iconclass">!empty($link['visible']) ? 'xar-icon' : 'xar-icon-disabled'</xar:set>
                                    <xar:set name="icontitle">!empty($link['visible']) ? $visibletitle : $invisibletitle</xar:set>
                                    <img src="#$visibleicon#" alt="visible" title="#$icontitle#" class="#$iconclass#"/>
                                <xar:else/>
                                    <img src="#$invisibleicon#" alt="invisible" title="#$invisibletitle#" class="xar-icon-disabled"/>
                                </xar:if>
                            </td>
                            <td class="xar-align-right xar-nowrap">
                                <xar:if condition="!empty($sublink['upurl'])">
                                    <a href="#$sublink['upurl']#" title="#$imguptitle#" class="xar-icon">
                                    <img src="#$imgup#" alt="#$imgupalt#" class="xar-icon"/>
                                    </a>
                                <xar:else/>
                                    <img src="#$imgup#" alt="#$imgupalt#" class="xar-icon-disabled"/>
                                </xar:if>
                                <xar:if condition="!empty($sublink['downurl'])">
                                    <a href="#$sublink['downurl']#" title="#$imgdowntitle#" class="xar-icon">
                                    <img src="#$imgdown#" alt="#$imgdownalt#" class="xar-icon"/>
                                    </a>
                                <xar:else/>
                                    <img src="#$imgdown#" alt="#$imgdownalt#" class="xar-icon-disabled"/>
                                </xar:if>
                                <xar:set name="select_id">$sub_id . '_select'</xar:set>
                                <xar:set name="select_name">$sub_name . '[select]'</xar:set>
                                <xar:data-input type="checkbox" id="$select_id" name="$select_name"/>
                            </td>
                        </tr>
                        </xar:foreach>
                    </xar:if>
                </xar:foreach>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="6" class="xar-align-right">
                        <xar:set name="link_selects">array(
                            array('id' => 'none', 'name' => '--- do nothing ---'),
                            array('id' => 'show', 'name' => 'Make Visible'),
                            array('id' => 'hide', 'name' => 'Make Invisible'),
                            array('id' => 'delete', 'name' => 'Delete'),
                        )</xar:set>
                        <label for="links_select">With selected links</label>:&#160;
                        <xar:data-input type="dropdown" name="links_select" id="links_select" options="$link_selects"/>
                    </td>
                </tr>
            </tfoot>
         </table>
        <table class="xar-fullwidth xar-margin-nonetop">
            <caption class="xar-align-left xar-margin-thickbottom xar-margin-thicktop">
                <strong>Insert New Menu Link</strong>
            </caption>
            <thead>
                <tr>
                    <th>&#160;</th>
                    <th>Label</th>
                    <th>Title</th>
                    <th>Url</th>
                    <th class="xar-align-right">options</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        |---
                    </td>
                    <td>
                        <xar:set name="new_label_id">'links_new_label'</xar:set>
                        <xar:data-input type="textbox" class="xar-form-textmedium" name="$new_label_id" id="$new_label_id" maxlength="255" value=""/>
                    </td>
                    <td>
                        <xar:set name="new_title_id">'links_new_title'</xar:set>
                        <xar:data-input type="textbox" class="xar-form-textlong" name="$new_title_id" id="$new_title_id" maxlength="255" value=""/>
                    </td>
                    <td>
                        <xar:set name="new_url_id">'links_new_url'</xar:set>
                        <xar:data-input type="textbox" class="xar-form-textlong" name="$new_url_id" id="$new_url_id" maxlength="255" value=""/>
                    </td>
                    <td class="xar-align-right xar-nowrap">
                        <xar:set name="new_blank_id">'links_new_blank'</xar:set>
                        <label for="#$new_blank_id#">Insert Blank</label>&#160;
                        <xar:data-input type="checkbox" name="$new_blank_id" id="$new_blank_id"/>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="5" class="xar-align-center">
                        <xar:set name="new_relation_id">'links_new_relation'</xar:set>
                        <label for="#$new_relation_id#">In Relation To</label>&#160;
                        <xar:data-input type="dropdown" name="$new_relation_id" id="$new_relation_id" options="$userlinks"/>&#160;&#160;
                        <xar:set name="new_position_id">'links_new_position'</xar:set>
                        <xar:set name="positions">array(
                            array('id' => 0, 'name' => 'Right before, in the same level'),
                            array('id' => 1, 'name' => 'Right after, in the same level'),
                            array('id' => 2, 'name' => 'The first child link'),
                            array('id' => 3, 'name' => 'The last child link'),
                        )</xar:set>
                        <label for="#$new_position_id#">Position</label>&#160;
                        <xar:data-input type="dropdown" name="$new_position_id" id="$new_position_id" options="$positions"/>
                    </td>
                </tr>
            </tfoot>
         </table>
    </xar:if>

    <table class="xar-fullwidth xar-margin-nonetop">
        <caption class="xar-align-left xar-margin-thickbottom xar-margin-nonetop">
            <strong>Module Links</strong>
        </caption>
        <thead>
            <tr>
                <th class="xar-align-left">
                    Module
                </th>
                <th class="xar-align-left">
                    Alias
                </th>
                <th class="xar-align-left">
                    Required Access Group or Level
                </th>
                <th class="xar-align-center">
                    Visible
                </th>
            </tr>
        </thead>
        <tbody>
        <xar:foreach in="$modules" value="$module">
            <tr>
                <td>
                    #$module['name']#
                </td>
                <td>
                    <xar:if condition="!empty($module['aliases'])">
                        <xar:set name="inputname">"modulelist[".$module['name']."][alias_name]"</xar:set>
                        <xar:set name="inputid">"modulelist_".$module['name']."_alias_name"</xar:set>
                        <xar:set name="inputval">!empty($modulelist[$module['name']]['alias_name']) ? $modulelist[$module['name']]['alias_name'] : $module['name']</xar:set>
                        <xar:set name="inputfirst">array('id' => $module['name'], 'name' => $module['displayname'])</xar:set>
                        <xar:data-input type="dropdown" name="$inputname" id="$inputid" firstline="$inputfirst" options="$module['aliases']" value="$inputval"/>
                    <xar:else/>
                        [none]
                    </xar:if>
                </td>
                <td>
                    <!-- fixme the access property should be able to handle this
                    <xar:set name="inputname">"modulelist[".$module['name']."][view_access]"</xar:set>
                     -->
                    <xar:set name="inputid">"modulelist_".$module['name']."_view_access"</xar:set>
                    <xar:if condition="isset($modulelist[$module['name']]['view_access'])">
                        <xar:set name="inputval">$modulelist[$module['name']]['view_access']</xar:set>
                    <xar:else />
                        <xar:set name="inputval">
                            array(
                                'group' => 0,
                                'level' => 100,
                                'failure' => 0
                            )
                        </xar:set>
                    </xar:if>
                    <xar:data-input type="access" name="$inputid" layout="horizontal" failure="1" value="$inputval" />
                </td>
                <td class="xar-align-center">
                    <xar:set name="inputname">"modulelist[".$module['name']."][visible]"</xar:set>
                    <xar:set name="inputid">"modulelist_".$module['name']."_visible"</xar:set>
                    <xar:set name="inputval">!empty($modulelist[$module['name']]['visible'])</xar:set>
                    <xar:data-input type="checkbox" name="$inputname" id="$inputid" value="$inputval"/>
                </td>
            </tr>
        </xar:foreach>
        </tbody>
    </table>

</xar:template>