#!/usr/bin/php5
<?php
// Prototype to dump a database in XML format according to the schema
// defined in this directory. This file needs to be run from the root
// of a Xaraya directory

/* We need a (fake) ip address to run xar */
putenv("REMOTE_ADDR=10.0.0.1");
$user = 'Admin';
$pass = '12345';
$tpl  ='/var/mt/xar/core/core.2.x/tests/xml/schemas/ddl/db2xml.xd';


include 'includes/xarCore.php';
xarCoreInit(XARCORE_SYSTEM_ALL);
//echo "Core initialized\n";

/* Make sure we handle boney instead of fancy */
set_exception_handler(array('ExceptionHandlers','bone'));
/* Authenticate */
if(!xarUserLogin($user,$pass)) {
    echo "Authentication failed\n";
    return 1;
} else {
    //echo "Authenticated\n";
}

$dbconn = xarDbGetconn();
$dbInfo = $dbconn->getDatabaseInfo();
$tplData = array(
    'dbname' => $dbInfo->getName(),
    'tables' => $dbInfo->getTables());

// Produce the xml
$blc = xarTpl__getCompilerInstance();
$tpc = $blc->compileFile($tpl);
$out = xarTpl__execute($tpc,$tplData, $tpl);
echo $out;
?>